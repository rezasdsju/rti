<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vocabulary MCQ Exam</title>
  <script>
    // Configure MathJax before loading the script
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      svg: {
        fontCache: 'global'
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --bg:#0f172a;
      --card:#111827;
      --muted:#94a3b8;
      --text:#e5e7eb;
      --accent:#22c55e;
      --accent-weak:#16a34a;
      --danger:#ef4444;
      --warning:#f59e0b;
      --info:#60a5fa;
      --ring: rgba(34,197,94,0.4);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: linear-gradient(180deg, #0b1220, var(--bg));
      color: var(--text);
    }
    .container { max-width: 950px; width: 100%; margin: 0 auto; padding: 0 20px; flex: 1; }
    header{ width: 72%; position: sticky; top: 0; z-index: 10; backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(2,6,23,0.92), rgba(2,6,23,0.6));
      border-bottom: 1px solid rgba(148,163,184,0.15);
    }
    .header-inner{ display:flex; align-items:center; gap:16px; padding:14px 24px;}
    .brand{ font-weight:700; letter-spacing:0.3px; }
    .pill{ padding: 6px 10px; background: #0b1324; border:1px solid rgba(148,163,184,0.15); border-radius: 9999px; color: var(--muted); font-size:12px; }
    .timer{ margin-left:auto; font-variant-numeric: tabular-nums; font-weight:700; padding:6px 12px; border-radius:10px; background:#0b1a2f; border:1px solid rgba(96,165,250,0.3); color:#bfdbfe; }
    .controls{ display:flex; gap:8px; }
    button{ background: #0b1220; color: var(--text); border:1px solid rgba(148,163,184,0.2); border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:600;}
    button:hover{ border-color: rgba(148,163,184,0.35); }
    button.primary{ background: linear-gradient(180deg, var(--accent), var(--accent-weak)); border-color: transparent; color:#052e16; }
    button.primary:hover{ filter: brightness(0.98); }

    .card{ background: #0b1220; border:1px solid rgba(148,163,184,0.15); border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.35); }
    .intro{ padding: 20px; margin-top: 16px; }
    .intro p{ color: var(--muted); margin:8px 0 0; }

    .meta{ display:flex; flex-wrap:wrap; gap:12px; margin-top:10px; }
    .meta .chip{ font-size: 13px; padding:6px 10px; border-radius:8px; background:#091225; border:1px solid rgba(148,163,184,0.2); color:#cbd5e1 }

    .question{ padding: 20px; border-top: 1px solid rgba(148,163,184,0.12); }
    .q-head{ display:flex; gap:10px; align-items:flex-start; }
    .q-num{ width:34px; height:34px; border-radius:50%; display:grid; place-content:center; background:#0b1a2f; color:#bfdbfe; font-weight:700; border:1px solid rgba(96,165,250,0.35) }
    .q-text{ font-weight:600; line-height:1.4 }

    .options{ margin-top:12px; display:grid; gap:10px; }

    .option{ display:flex; align-items:flex-start; gap:12px; padding:12px; border:1px solid rgba(148,163,184,0.18); border-radius:12px; cursor:pointer; background:#0a1020; }
    .option:hover{ border-color: rgba(148,163,184,0.32) }
    .option input{ appearance:none; -webkit-appearance:none; width:18px; height:18px; border-radius: 50%; border:2px solid #93c5fd; margin-top:3px; display:inline-grid; place-content:center; outline:none; }
    .option input::before{ content:""; width:10px; height:10px; border-radius:50%; transform: scale(0); transition:120ms transform ease-in-out; background: #60a5fa; }
    .option input:checked::before{ transform: scale(1); }
    .option .opt-text{ flex:1; }

    .actions{ position:sticky; bottom:0; background:linear-gradient(180deg, rgba(2,6,23,0), rgba(2,6,23,0.9) 25%, rgba(2,6,23,1)); padding:16px 24px; display:flex; gap:10px; justify-content:space-between; align-items:center; border-top:1px solid rgba(148,163,184,0.15);}

    .result{ padding: 18px 20px; border-top: 1px solid rgba(148,163,184,0.12); background:#081427; }
    .result strong{ color:#bbf7d0 }
    .legend{ display:flex; gap:10px; flex-wrap:wrap; color:var(--muted); font-size:14px }
    .legend span{ display:inline-flex; align-items:center; gap:6px; padding:4px 8px; background:#0b1324; border:1px solid rgba(148,163,184,0.2); border-radius:9999px }
    .dot{ width:10px; height:10px; border-radius:50% }
    .dot.correct{ background: var(--accent) }
    .dot.wrong{ background: var(--danger) }
    .dot.unanswered{ background: #facc15; }

    .unanswered-chip { color: #facc15; border-color: rgba(250, 204, 21, 0.4); }
    .correct-chip { color: #22c55e; border-color: rgba(250, 204, 21, 0.4); }
    .wrong-chip { color: #ef4444; border-color: rgba(250, 204, 21, 0.4); }

    .correct{ border-color: rgba(34,197,94,0.6) !important; background: rgba(34,197,94,0.06) }
    .wrong{ border-color: rgba(239,68,68,0.6) !important; background: rgba(239,68,68,0.06) }

    .explanation-container { margin-top: 12px; padding: 12px; border-radius: 8px; background: rgba(30, 41, 59, 0.4); }
    .result-status { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-weight: 600;}
    .correct-status { color: var(--accent); }
    .wrong-status { color: var(--danger); }
    .unanswered-status { color: #facc15; }
    .explain{ color:#cbd5e1; font-size:14px; opacity:0.95; margin: 0; }

    .hidden{ display:none !important }
    .mute{ color: var(--muted) }
    .footer-note{ text-align:center; color:var(--muted); margin: 16px 0 40px; font-size:13px }
    .score-badge{ font-weight:800; color:#052e16; background:linear-gradient(180deg, #86efac, #22c55e); border-radius:9999px; padding:6px 12px; border:1px solid var(--accent-weak) }

    .back-button {
        display: inline-block;
        margin: 30px auto;
        padding: 12px 30px;
        background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%);
        color: white;
        text-decoration: none;
        border-radius: 50px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        max-width: 200px;
        justify-content: center;
    }

    .back-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        background: linear-gradient(135deg, #4a6491 0%, #2c3e50 100%);
    }

    .button-container { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }

    @media (max-width:640px){
        .q-head{ flex-direction:column; }
        .button-container { flex-direction: column; align-items: center; }
        header{ width: 100%; }
    }
  </style>
</head>
<body>
    <div id="menu-container"></div>
    <script>
        fetch("menu.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("menu-container").innerHTML = data;
                
                // Now that the content is loaded, get the elements and add the event listener
                const hamburger = document.querySelector('.hamburger');
                const navMenu = document.querySelector('.nav-menu');
                
                if (hamburger && navMenu) {
                    hamburger.addEventListener('click', () => {
                        navMenu.classList.toggle('active');
                        
                        const icon = hamburger.querySelector('i');
                        if (navMenu.classList.contains('active')) {
                            icon.classList.remove('fa-bars');
                            icon.classList.add('fa-times');
                        } else {
                            icon.classList.remove('fa-times');
                            icon.classList.add('fa-bars');
                        }
                    });
                }
            });
    </script>
  <header>
    <div class="header-inner container">
      <div class="brand">üìù Vocabulary MCQ Exam</div>
      <span class="pill">10 Questions ‚Ä¢ 10 Minutes ‚Ä¢ +1 / ‚àí0.25 / 0</span>
      <div id="timer" class="timer" aria-live="polite">20:00</div>
      <div class="controls">
        <button id="startBtn" class="primary">Start Exam</button>
        <button id="resetBtn" title="Start a new exam">New Exam</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card intro" id="intro">
      <h2 style="margin:0 0 6px">Instructions</h2>
      <ul>
        <li>Scoring: Correct +1, Wrong ‚àí0.25, Unanswered 0.</li>
        <li>Time limit: 10 minutes. Auto-submit when time ends.</li>
        <li>All questions appear on one page ‚Äî scroll to navigate.</li>
      </ul>
    </section>

    <div id="summary" class="card result hidden" role="status" aria-live="polite"></div>

    <form id="exam" class="card" autocomplete="off"></form>

    <div class="actions">
      <div class="legend">
        <span><span class="dot correct"></span> Correct</span>
        <span><span class="dot wrong"></span> Wrong</span>
        <span><span class="dot unanswered"></span> Unanswered</span>
      </div>
      <button id="submitBtn" class="primary" disabled>Submit Exam</button>
    </div>

    <div class="button-container">
        <a href='index.html' class='back-button'>
            <i class="fas fa-arrow-left"></i> Back to Home
        </a>
        <a href='mcq_of.html' class='back-button'>
            <i class="fas fa-arrow-left"></i> Back to Previous Page
        </a>
    </div>
  </main>

  <script>
  // ----------------------------
  // Utilities
  // ----------------------------
  const EXAM_SIZE = 10;
  const EXAM_MINUTES = 10; // minutes
  const STORAGE_KEY = 'narration_exam_state_v2';
  const qs = (sel, el=document) => el.querySelector(sel);
  const qsa = (sel, el=document) => [...el.querySelectorAll(sel)];
  const pick = (arr, n) => {
    const a = [...arr];
    for (let i=a.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
    return a.slice(0, n);
  };
  function formatTime(s){ const m = Math.floor(s/60).toString().padStart(2,'0'); const r = Math.floor(s%60).toString().padStart(2,'0'); return `${m}:${r}`; }
  function saveState(state){ sessionStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
  function loadState(){ try{ return JSON.parse(sessionStorage.getItem(STORAGE_KEY)||'null'); }catch{return null} }
  function clearState(){ sessionStorage.removeItem(STORAGE_KEY); }

  // ----------------------------
  // Question Pool
  // ----------------------------
  const QUESTIONS = [
    {
      id: 1,
      q: "$|\\overline{A}|=|\\overline{B}|=3$ ‡¶è‡¶¨‡¶Ç $\\theta$ ‡¶π‡¶≤‡ßá $|\\overline{A} \\times \\overline{B}|=?$",
      options: ["$9\\cos\\theta$", "$9\\sin\\theta$", "$\\frac{1}{9}\\sin\\theta$", "$\\frac{1}{9}\\cos\\theta$"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ |\\overline{A} \\times \\overline{B}| = |A||B|\\sin\\theta = 3 \\times 3 \\sin\\theta = 9\\sin\\theta \\]"
    },
    {
      id: 2,
      q: "$\\overline{A} = 2\\hat{i} + 3\\hat{j} - \\hat{k}$ ‡¶è‡¶¨‡¶Ç $\\overline{B} = \\hat{i} - 2\\hat{j} + 2\\hat{k}$ ‡¶π‡¶≤‡ßá $\\overline{A} \\cdot \\overline{B} = ?$",
      options: ["$-2$", "$0$", "$2$", "$4$"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ \\overline{A} \\cdot \\overline{B} = (2)(1) + (3)(-2) + (-1)(2) = 2 - 6 - 2 = -6 \\]"
    },
    {
      id: 3,
      q: "$\\overline{A} = 3\\hat{i} + 4\\hat{j}$ ‡¶π‡¶≤‡ßá $|\\overline{A}|$ ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶® ‡¶ï‡¶§?",
      options: ["$5$", "$7$", "$12$", "$25$"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ |\\overline{A}| = \\sqrt{3^2 + 4^2} = \\sqrt{9 + 16} = \\sqrt{25} = 5 \\]"
    },
    {
      id: 4,
      q: "$\\overline{A} = 2\\hat{i} - \\hat{j} + 3\\hat{k}$ ‡¶è‡¶¨‡¶Ç $\\overline{B} = \\hat{i} + 2\\hat{j} - \\hat{k}$ ‡¶π‡¶≤‡ßá $\\overline{A} + \\overline{B} = ?$",
      options: ["$3\\hat{i} + \\hat{j} + 2\\hat{k}$", "$3\\hat{i} + \\hat{j} - 2\\hat{k}$", "$3\\hat{i} - \\hat{j} + 2\\hat{k}$", "$\\hat{i} + 3\\hat{j} + 2\\hat{k}$"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ \\overline{A} + \\overline{B} = (2+1)\\hat{i} + (-1+2)\\hat{j} + (3-1)\\hat{k} = 3\\hat{i} + \\hat{j} + 2\\hat{k} \\]"
    },
    {
      id: 5,
      q: "$\\overline{A} = 4\\hat{i} - 3\\hat{j}$ ‡¶è‡¶¨‡¶Ç $\\overline{B} = 2\\hat{i} + 5\\hat{j}$ ‡¶π‡¶≤‡ßá $2\\overline{A} - \\overline{B} = ?$",
      options: ["$6\\hat{i} - 11\\hat{j}$", "$10\\hat{i} - 11\\hat{j}$", "$6\\hat{i} + 11\\hat{j}$", "$10\\hat{i} + 11\\hat{j}$"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ 2\\overline{A} - \\overline{B} = 2(4\\hat{i} - 3\\hat{j}) - (2\\hat{i} + 5\\hat{j}) = (8-2)\\hat{i} + (-6-5)\\hat{j} = 6\\hat{i} - 11\\hat{j} \\]"
    },
    {
      id: 6,
      q: "$\\overline{A} = 2\\hat{i} + 3\\hat{j} - \\hat{k}$ ‡¶è‡¶¨‡¶Ç $\\overline{B} = \\hat{i} - \\hat{j} + 2\\hat{k}$ ‡¶π‡¶≤‡ßá $\\overline{A} \\times \\overline{B} = ?$",
      options: ["$5\\hat{i} - 5\\hat{j} - 5\\hat{k}$", "$5\\hat{i} + 5\\hat{j} - 5\\hat{k}$", "$5\\hat{i} - 5\\hat{j} + 5\\hat{k}$", "$-5\\hat{i} - 5\\hat{j} - 5\\hat{k}$"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ \\overline{A} \\times \\overline{B} = \\begin{vmatrix} \\hat{i} & \\hat{j} & \\hat{k} \\\\ 2 & 3 & -1 \\\\ 1 & -1 & 2 \\end{vmatrix} = (6-1)\\hat{i} - (4+1)\\hat{j} + (-2-3)\\hat{k} = 5\\hat{i} - 5\\hat{j} - 5\\hat{k} \\]"
    },
    {
      id: 7,
      q: "$\\overline{A} = 3\\hat{i} + 4\\hat{j}$ ‡¶è‡¶¨‡¶Ç $\\overline{B} = 5\\hat{i} - 12\\hat{j}$ ‡¶π‡¶≤‡ßá $\\overline{A} \\cdot \\overline{B} = ?$",
      options: ["$-33$", "$-15$", "$15$", "$33$"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ \\overline{A} \\cdot \\overline{B} = (3)(5) + (4)(-12) = 15 - 48 = -33 \\]"
    },
    {
      id: 8,
      q: "$\\overline{A} = 2\\hat{i} - \\hat{j} + 3\\hat{k}$ ‡¶π‡¶≤‡ßá $|\\overline{A}|$ ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶® ‡¶ï‡¶§?",
      options: ["$\\sqrt{6}$", "$\\sqrt{10}$", "$\\sqrt{14}$", "$\\sqrt{20}$"],
      answer: 2,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ |\\overline{A}| = \\sqrt{2^2 + (-1)^2 + 3^2} = \\sqrt{4 + 1 + 9} = \\sqrt{14} \\]"
    },
    {
      id: 9,
      q: "$\\overline{A} = \\hat{i} + 2\\hat{j} - 3\\hat{k}$ ‡¶è‡¶¨‡¶Ç $\\overline{B} = 2\\hat{i} - \\hat{j} + \\hat{k}$ ‡¶π‡¶≤‡ßá $\\overline{A} - 2\\overline{B} = ?$",
      options: ["$-3\\hat{i} + 4\\hat{j} - 5\\hat{k}$", "$-3\\hat{i} - 4\\hat{j} - 5\\hat{k}$", "$-3\\hat{i} + 4\\hat{j} + 5\\hat{k}$", "$3\\hat{i} + 4\\hat{j} - 5\\hat{k}$"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ \\overline{A} - 2\\overline{B} = (\\hat{i} + 2\\hat{j} - 3\\hat{k}) - 2(2\\hat{i} - \\hat{j} + \\hat{k}) = (1-4)\\hat{i} + (2+2)\\hat{j} + (-3-2)\\hat{k} = -3\\hat{i} + 4\\hat{j} - 5\\hat{k} \\]"
    },
    {
      id: 10,
      q: "$\\overline{A} = 3\\hat{i} - 2\\hat{j} + \\hat{k}$ ‡¶è‡¶¨‡¶Ç $\\overline{B} = \\hat{i} + \\hat{j} - 2\\hat{k}$ ‡¶π‡¶≤‡ßá $\\overline{A} \\cdot \\overline{B} = ?$",
      options: ["$-1$", "$0$", "$1$", "$3$"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ \\overline{A} \\cdot \\overline{B} = (3)(1) + (-2)(1) + (1)(-2) = 3 - 2 - 2 = -1 \\]"
    },
    {
      id: 11,
      q: "$\\overline{A} = 4\\hat{i} + 3\\hat{j}$ ‡¶è‡¶¨‡¶Ç $\\overline{B} = 2\\hat{i} - 6\\hat{j}$ ‡¶π‡¶≤‡ßá $\\overline{A} + \\overline{B} = ?$",
      options: ["$6\\hat{i} - 3\\hat{j}$", "$6\\hat{i} + 9\\hat{j}$", "$2\\hat{i} + 9\\hat{j}$", "$2\\hat{i} - 3\\hat{j}$"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ \\overline{A} + \\overline{B} = (4+2)\\hat{i} + (3-6)\\hat{j} = 6\\hat{i} - 3\\hat{j} \\]"
    },
    {
      id: 12,
      q: "$\\overline{A} = 2\\hat{i} - 3\\hat{j} + \\hat{k}$ ‡¶è‡¶¨‡¶Ç $\\overline{B} = -\\hat{i} + 2\\hat{j} + 3\\hat{k}$ ‡¶π‡¶≤‡ßá $\\overline{A} \\times \\overline{B} = ?$",
      options: ["$-11\\hat{i} - 7\\hat{j} + \\hat{k}$", "$-11\\hat{i} + 7\\hat{j} + \\hat{k}$", "$11\\hat{i} - 7\\hat{j} + \\hat{k}$", "$11\\hat{i} + 7\\hat{j} - \\hat{k}$"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ \\overline{A} \\times \\overline{B} = \\begin{vmatrix} \\hat{i} & \\hat{j} & \\hat{k} \\\\ 2 & -3 & 1 \\\\ -1 & 2 & 3 \\end{vmatrix} = (-9-2)\\hat{i} - (6+1)\\hat{j} + (4-3)\\hat{k} = -11\\hat{i} - 7\\hat{j} + \\hat{k} \\]"
    },
    {
      id: 13,
      q: "$\\overline{A} = 5\\hat{i} - 12\\hat{j}$ ‡¶π‡¶≤‡ßá $|\\overline{A}|$ ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶® ‡¶ï‡¶§?",
      options: ["$7$", "$13$", "$17$", "$25$"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ |\\overline{A}| = \\sqrt{5^2 + (-12)^2} = \\sqrt{25 + 144} = \\sqrt{169} = 13 \\]"
    },
    {
      id: 14,
      q: "$\\overline{A} = 3\\hat{i} + 4\\hat{j} - 5\\hat{k}$ ‡¶è‡¶¨‡¶Ç $\\overline{B} = 2\\hat{i} - \\hat{j} + 3\\hat{k}$ ‡¶π‡¶≤‡ßá $\\overline{A} \\cdot \\overline{B} = ?$",
      options: ["$-5$", "$5$", "$-19$", "$19$"],
      answer: 2,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ \\overline{A} \\cdot \\overline{B} = (3)(2) + (4)(-1) + (-5)(3) = 6 - 4 - 15 = -13 \\]"
    },
    {
      id: 15,
      q: "$\\overline{A} = 2\\hat{i} - \\hat{j} + 3\\hat{k}$ ‡¶è‡¶¨‡¶Ç $\\overline{B} = \\hat{i} + 2\\hat{j} - \\hat{k}$ ‡¶π‡¶≤‡ßá $3\\overline{A} - 2\\overline{B} = ?$",
      options: ["$4\\hat{i} - 7\\hat{j} + 11\\hat{k}$", "$4\\hat{i} + 7\\hat{j} + 11\\hat{k}$", "$4\\hat{i} - 7\\hat{j} - 11\\hat{k}$", "$-4\\hat{i} - 7\\hat{j} + 11\\hat{k}$"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ:<br>\\[ 3\\overline{A} - 2\\overline{B} = 3(2\\hat{i} - \\hat{j} + 3\\hat{k}) - 2(\\hat{i} + 2\\hat{j} - \\hat{k}) = (6-2)\\hat{i} + (-3-4)\\hat{j} + (9+2)\\hat{k} = 4\\hat{i} - 7\\hat{j} + 11\\hat{k} \\]"
    }
  ];

  // ----------------------------
  // State
  // ----------------------------
  let selectedIds = [];
  let selectedMap = {}; // { qid: optionIndex }
  let endTime = null; // epoch seconds
  let submitted = false;
  let timerHandle = null;

  const examForm = qs('#exam');
  const startBtn = qs('#startBtn');
  const resetBtn = qs('#resetBtn');
  const submitBtn = qs('#submitBtn');
  const timerEl = qs('#timer');
  const summaryEl = qs('#summary');
  const introEl = qs('#intro');

  // ----------------------------
  // Rendering
  // ----------------------------
  async function renderQuestions(){
    examForm.innerHTML = '';
    const chosen = QUESTIONS.filter(q=>selectedIds.includes(q.id));
    chosen.forEach((q,idx)=>{
      const qWrap = document.createElement('section');
      qWrap.className = 'question';
      qWrap.setAttribute('data-qid', q.id);

      qWrap.innerHTML = `
        <div class="q-head">
          <div class="q-num">${idx+1}</div>
          <div class="q-text">${q.q}</div>
        </div>
        <div class="options" role="radiogroup" aria-label="Question ${idx+1}">
          ${q.options.map((opt,i)=>{
            const checked = selectedMap[q.id] === i ? 'checked' : '';
            return `
              <label class="option">
                <input type="radio" name="q_${q.id}" value="${i}" ${checked} aria-label="Option ${String.fromCharCode(65+i)}">
                <div class="opt-text"><strong>(${String.fromCharCode(65+i)})</strong> ${opt}</div>
              </label>
            `;}).join('')}
        </div>
      `;
      examForm.appendChild(qWrap);
    });

    qsa('input[type=radio]', examForm).forEach(inp=>{
      inp.addEventListener('change', e=>{
        const qid = parseInt(e.target.name.split('_')[1],10);
        selectedMap[qid] = parseInt(e.target.value,10);
        persist();
      });
    });

    // Typeset the new content
    if(window.MathJax) {
      await MathJax.typesetPromise();
    }
  }

  function renderSummary(score, details){
    const total = EXAM_SIZE;
    const correct = details.filter(d=>d.correct).length;
    const wrong = details.filter(d=>d.user!==null && !d.correct).length;
    const unanswered = total - correct - wrong;

    summaryEl.classList.remove('hidden');
    summaryEl.innerHTML = `
      <div style="display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap">
        <div style="display:flex; gap:12px; align-items:center">
          <span class="score-badge" title="Final Score">Score: ${score.toFixed(2)} / ${total.toFixed(2)}</span>
          <span class="chip correct-chip">‚úÖ ${correct} correct</span>
          <span class="chip wrong-chip">‚ùå ${wrong} wrong</span>
          <span class="chip unanswered-chip">‚è≥ ${unanswered} unanswered</span>
        </div>
        <button onclick="window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'})"> Go to Bottom</button>
      </div>
    `;
  }

  async function markReview(details){
    details.forEach((d)=>{
      const sec = qs(`.question[data-qid="${d.id}"]`);
      if(!sec) return;
      const labels = qsa('.option', sec);
      labels.forEach((lbl, idx)=>{
        lbl.classList.remove('correct','wrong');
        const inp = lbl.querySelector('input');
        if(d.user===null) return; // unanswered
        if(idx===d.answer) lbl.classList.add('correct');
        if(d.user===idx && idx!==d.answer) lbl.classList.add('wrong');
      });

      // Explanation
      let expEl = sec.querySelector('.explanation-container');
      if(!expEl){
        expEl = document.createElement('div');
        expEl.className = 'explanation-container';
        sec.appendChild(expEl);
      }
      const statusClass = d.user===null ? 'unanswered-status' : d.correct ? 'correct-status' : 'wrong-status';
      const statusText = d.user===null ? 'Unanswered' : d.correct ? 'Correct' : 'Wrong';
      expEl.innerHTML = `<div class="result-status ${statusClass}">${statusText}</div><p class="explain">${d.explain}</p>`;
    });

    // Typeset the new content
    if(window.MathJax) {
      await MathJax.typesetPromise();
    }
  }

  // ----------------------------
  // Exam Logic
  // ----------------------------
  function persist(){
    saveState({selectedIds, selectedMap, endTime, submitted});
  }

  function startExam(){
    introEl.classList.add('hidden');
    selectedIds = pick(QUESTIONS, EXAM_SIZE).map(q=>q.id);
    selectedMap = {};
    submitted = false;
    endTime = Date.now() + EXAM_MINUTES*60*1000;
    persist();
    renderQuestions();
    submitBtn.disabled = false;
    startTimer();
  }

  function startTimer(){
    if(timerHandle) clearInterval(timerHandle);
    timerHandle = setInterval(()=>{
      const remaining = Math.floor((endTime - Date.now())/1000);
      if(remaining<=0){
        timerEl.textContent = "00:00";
        clearInterval(timerHandle);
        submitExam();
      } else {
        timerEl.textContent = formatTime(remaining);
      }
    }, 1000);
  }

  function submitExam(){
    if(submitted) return;
    submitted = true;
    clearInterval(timerHandle);

    const details = selectedIds.map(qid=>{
      const q = QUESTIONS.find(x=>x.id===qid);
      const user = selectedMap[qid]!==undefined ? selectedMap[qid] : null;
      const correct = user===q.answer;
      return {id:qid, user, answer:q.answer, correct, explain:q.explain};
    });

    const score = details.reduce((acc,d)=>{
      if(d.user===null) return acc;
      return acc + (d.correct?1:-0.25);
    },0);

    renderSummary(score, details);
    markReview(details);
    submitBtn.disabled = true;
    persist();
  }

  function resetExam(){
    clearState();
    location.reload();
  }

  // ----------------------------
  // Event Listeners
  // ----------------------------
  startBtn.addEventListener('click', startExam);
  submitBtn.addEventListener('click', submitExam);
  resetBtn.addEventListener('click', resetExam);

  // ----------------------------
  // Load saved state if exists
  // ----------------------------
  const state = loadState();
  if(state){
    selectedIds = state.selectedIds || [];
    selectedMap = state.selectedMap || {};
    endTime = state.endTime || null;
    submitted = state.submitted || false;
    if(selectedIds.length>0){
      introEl.classList.add('hidden');
      renderQuestions();
      if(!submitted){
        submitBtn.disabled = false;
        startTimer();
      } else {
        submitExam();
      }
    }
  }

  </script>
</body>
</html>