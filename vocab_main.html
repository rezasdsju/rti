<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vocubalary MCQ Exam</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --bg:#0f172a;
      --card:#111827;
      --muted:#94a3b8;
      --text:#e5e7eb;
      --accent:#22c55e;
      --accent-weak:#16a34a;
      --danger:#ef4444;
      --warning:#f59e0b;
      --info:#60a5fa;
      --ring: rgba(34,197,94,0.4);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: linear-gradient(180deg, #0b1220, var(--bg));
      color: var(--text);
    }
    .container {
        max-width: 950px;
        width: 100%;
        margin: 0 auto;
        padding: 0 20px;
        flex: 1;
    }
    header{
      width: 72%; position: sticky; top: 0; z-index: 10; backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(2,6,23,0.92), rgba(2,6,23,0.6));
      border-bottom: 1px solid rgba(148,163,184,0.15);
    }
    .header-inner{ display:flex; align-items:center; gap:16px; padding:14px 24px; /* width: 100%; max-width: none; margin: 0; */}
    .brand{ font-weight:700; letter-spacing:0.3px; }
    .pill{ padding: 6px 10px; background: #0b1324; border:1px solid rgba(148,163,184,0.15); border-radius: 9999px; color: var(--muted); font-size:12px; }
    .timer{ margin-left:auto; font-variant-numeric: tabular-nums; font-weight:700; padding:6px 12px; border-radius:10px; background:#0b1a2f; border:1px solid rgba(96,165,250,0.3); color:#bfdbfe; }
    .controls{ display:flex; gap:8px; }
    button{
      background: #0b1220; color: var(--text); border:1px solid rgba(148,163,184,0.2); border-radius:12px; padding:10px 14px; cursor:pointer; font-weight:600;
    }
    button:hover{ border-color: rgba(148,163,184,0.35); }
    button.primary{ background: linear-gradient(180deg, var(--accent), var(--accent-weak)); border-color: transparent; color:#052e16; }
    button.primary:hover{ filter: brightness(0.98); }

    .card{ background: #0b1220; border:1px solid rgba(148,163,184,0.15); border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.35); }
    .intro{ padding: 20px; margin-top: 16px; }
    .intro p{ color: var(--muted); margin:8px 0 0; }

    .meta{ display:flex; flex-wrap:wrap; gap:12px; margin-top:10px; }
    .meta .chip{ font-size: 13px; padding:6px 10px; border-radius:8px; background:#091225; border:1px solid rgba(148,163,184,0.2); color:#cbd5e1 }

    .question{ padding: 20px; border-top: 1px solid rgba(148,163,184,0.12); }
    .q-head{ display:flex; gap:10px; align-items:flex-start; }
    .q-num{ width:34px; height:34px; border-radius:50%; display:grid; place-content:center; background:#0b1a2f; color:#bfdbfe; font-weight:700; border:1px solid rgba(96,165,250,0.35) }
    .q-text{ font-weight:600; line-height:1.4 }

    .options{ margin-top:12px; display:grid; gap:10px; }

    /* Custom radio style */
    .option{
      display:flex; align-items:flex-start; gap:12px; padding:12px; border:1px solid rgba(148,163,184,0.18); border-radius:12px; cursor:pointer; background:#0a1020;
    }
    .option:hover{ border-color: rgba(148,163,184,0.32) }
    .option input{ appearance:none; -webkit-appearance:none; width:18px; height:18px; border-radius: 50%; border:2px solid #93c5fd; margin-top:3px; display:inline-grid; place-content:center; outline:none; }
    .option input::before{ content:""; width:10px; height:10px; border-radius:50%; transform: scale(0); transition:120ms transform ease-in-out; background: #60a5fa; }
    .option input:checked::before{ transform: scale(1); }
    .option .opt-text{ flex:1; }

    .actions{ position:sticky; bottom:0; background:linear-gradient(180deg, rgba(2,6,23,0), rgba(2,6,23,0.9) 25%, rgba(2,6,23,1)); padding:16px 24px; display:flex; gap:10px; justify-content:space-between; align-items:center; border-top:1px solid rgba(148,163,184,0.15);}

    .result{ padding: 18px 20px; border-top: 1px solid rgba(148,163,184,0.12); background:#081427; }
    .result strong{ color:#bbf7d0 }
    .legend{ display:flex; gap:10px; flex-wrap:wrap; color:var(--muted); font-size:14px }
    .legend span{ display:inline-flex; align-items:center; gap:6px; padding:4px 8px; background:#0b1324; border:1px solid rgba(148,163,184,0.2); border-radius:9999px }
    .dot{ width:10px; height:10px; border-radius:50% }
    .dot.correct{ background: var(--accent) }
    .dot.wrong{ background: var(--danger) }
    .dot.unanswered{ background: #facc15; }

    .unanswered-chip {
        color: #facc15;
        border-color: rgba(250, 204, 21, 0.4); 
     }
     
     .correct-chip {
        color: #22c55e;
        border-color: rgba(250, 204, 21, 0.4); 
     }

     .wrong-chip {
        color: #ef4444;
        border-color: rgba(250, 204, 21, 0.4); 
     }


    .correct{ border-color: rgba(34,197,94,0.6) !important; background: rgba(34,197,94,0.06) }
    .wrong{ border-color: rgba(239,68,68,0.6) !important; background: rgba(239,68,68,0.06) }
    
    /* Enhanced explanation styling */
    .explanation-container { margin-top: 12px; padding: 12px; border-radius: 8px; background: rgba(30, 41, 59, 0.4); }
    .result-status { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-weight: 600;}
    .correct-status { color: var(--accent); }
    .wrong-status { color: var(--danger); }
    .unanswered-status { color: #facc15; } 
    .explain{ color:#cbd5e1; font-size:14px; opacity:0.95; margin: 0; }

    .hidden{ display:none !important }
    .mute{ color: var(--muted) }
    .footer-note{ text-align:center; color:var(--muted); margin: 16px 0 40px; font-size:13px }
    .score-badge{ font-weight:800; color:#052e16; background:linear-gradient(180deg, #86efac, #22c55e); border-radius:9999px; padding:6px 12px; border:1px solid var(--accent-weak) }
    
    .back-button {
        display: inline-block;
        margin: 30px auto;
        padding: 12px 30px;
        background: linear-gradient(135deg, #2c3e50 0%, #4a6491 100%);
        color: white;
        text-decoration: none;
        border-radius: 50px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        max-width: 200px;
        justify-content: center;
    }
    
    .back-button:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        background: linear-gradient(135deg, #4a6491 0%, #2c3e50 100%);
    }
    
    .button-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
    }
    
    @media (max-width:640px){ 
        .q-head{ flex-direction:column; }
        .button-container { flex-direction: column; align-items: center; }
        header{
          width: 100%;
        }
    }
    
  </style>
</head>
<body>
    <div id="menu-container"></div>
    <script>
        fetch("menu.html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("menu-container").innerHTML = data;
                
                // Now that the content is loaded, get the elements and add the event listener
                const hamburger = document.querySelector('.hamburger');
                const navMenu = document.querySelector('.nav-menu');
                
                if (hamburger && navMenu) {
                    hamburger.addEventListener('click', () => {
                        navMenu.classList.toggle('active');
                        
                        const icon = hamburger.querySelector('i');
                        if (navMenu.classList.contains('active')) {
                            icon.classList.remove('fa-bars');
                            icon.classList.add('fa-times');
                        } else {
                            icon.classList.remove('fa-times');
                            icon.classList.add('fa-bars');
                        }
                    });
                }
            });
    </script>
  <header>
    <div class="header-inner container">
      <div class="brand">üìù Voculabalary MCQ Exam</div>
      <span class="pill">10 Questions ‚Ä¢ 10 Minutes ‚Ä¢ +1 / ‚àí0.25 / 0</span>
      <div id="timer" class="timer" aria-live="polite">20:00</div>
      <div class="controls">
        <button id="startBtn" class="primary">Start Exam</button>
        <button id="resetBtn" title="Start a new exam">New Exam</button>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card intro" id="intro">
      <h2 style="margin:0 0 6px">Instructions</h2>
      <ul>
        <!--<li>10 questions will be drawn randomly from the full pool.</li>
        <li>All questions are on <strong>Narration (Direct/Indirect Speech)</strong>.</li>-->
        <li>Scoring: Correct +1, Wrong ‚àí0.25, Unanswered 0.</li>
        <li>Time limit: 10 minutes. Auto-submit when time ends.</li>
        <li>All questions appear on one page ‚Äî scroll to navigate.</li>
      </ul>
    </section>

    <div id="summary" class="card result hidden" role="status" aria-live="polite"></div>

    <form id="exam" class="card" autocomplete="off"></form>

    <div class="actions">
      <div class="legend">
        <span><span class="dot correct"></span> Correct</span>
        <span><span class="dot wrong"></span> Wrong</span>
        <span><span class="dot unanswered"></span> Unanswered</span>
      </div>
      <button id="submitBtn" class="primary" disabled>Submit Exam</button>
    </div>
    
    <div class="button-container">
        <a href='index.html' class='back-button'>
            <i class="fas fa-arrow-left"></i> Back to Home
        </a>
        <a href='mcq_of.html' class='back-button'>
            <i class="fas fa-arrow-left"></i> Back to Previous Page
        </a>
    </div>
  </main>

  <script>
  // ----------------------------
  // Utilities
  // ----------------------------
  const EXAM_SIZE = 10;
  const EXAM_MINUTES = 10; // minutes
  const STORAGE_KEY = 'narration_exam_state_v1';

  const qs = (sel, el=document) => el.querySelector(sel);
  const qsa = (sel, el=document) => [...el.querySelectorAll(sel)];
  const pick = (arr, n) => {
    const a = [...arr];
    for (let i=a.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
    return a.slice(0, n);
  };

  function formatTime(s){
    const m = Math.floor(s/60).toString().padStart(2,'0');
    const r = Math.floor(s%60).toString().padStart(2,'0');
    return `${m}:${r}`;
  }

  function saveState(state){ sessionStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
  function loadState(){ try{ return JSON.parse(sessionStorage.getItem(STORAGE_KEY)||'null'); }catch{return null} }
  function clearState(){ sessionStorage.removeItem(STORAGE_KEY); }

  // ----------------------------
  // Question Pool (Narration)
  // Each question: { id, q, options:[], answer: index, explain }
  // ----------------------------









const QUESTIONS = [
    {
      id: 1,
      q: "Choose the Bengali meaning of: 'ubiquitous'",
      options: ["‡¶¨‡¶ø‡¶∞‡¶≤", "‡¶∏‡¶∞‡ßç‡¶¨‡¶§‡ßç‡¶∞ ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶®", "‡¶ó‡ßã‡¶™‡¶®", "‡¶Ö‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡¶∞"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) |'Ubiquitous' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßã '‡¶∏‡¶∞‡ßç‡¶¨‡¶§‡ßç‡¶∞ ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶®'‡•§ ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£‡¶∏‡ßç‡¶¨‡¶∞‡ßÇ‡¶™, ‡¶Ü‡¶ú‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶Æ‡¶æ‡¶∞‡ßç‡¶ü‡¶´‡ßã‡¶®‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶∏‡¶∞‡ßç‡¶¨‡¶§‡ßç‡¶∞ ‡¶¨‡¶ø‡¶¶‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® (ubiquitous)‡•§"
    },
    {
      id: 2,
      q: "Choose the English meaning of: '‡¶™‡¶∞‡¶ø‡¶™‡¶ï‡ßç‡¶¨'",
      options: ["Immature", "Mature", "Young", "New"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | '‡¶™‡¶∞‡¶ø‡¶™‡¶ï‡ßç‡¶¨' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø ‡¶Ö‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßã 'Mature' ‡¶Ø‡¶æ ‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡¶¨‡¶ø‡¶ï‡¶∂‡¶ø‡¶§ ‡¶¨‡¶æ ‡¶™‡¶∞‡¶ø‡¶£‡¶§ ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 3,
      q: "Choose the synonym of: 'Benevolent'",
      options: ["Cruel", "Kind", "Stingy", "Selfish"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | 'Benevolent' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∂‡¶¨‡ßç‡¶¶ ‡¶π‡¶≤‡ßã 'Kind' ‡¶Ø‡¶æ ‡¶¶‡¶Ø‡¶º‡¶æ‡¶≤‡ßÅ ‡¶¨‡¶æ ‡¶™‡¶∞‡ßã‡¶™‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 4,
      q: "Choose the antonym of: 'Courage'",
      options: ["Bravery", "Fear", "Confidence", "Daring"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) |'Courage' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶¨‡¶ø‡¶™‡¶∞‡ßÄ‡¶§ ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶π‡¶≤‡ßã 'Fear' ‡¶Ø‡¶æ ‡¶≠‡¶Ø‡¶º ‡¶¨‡¶æ ‡¶∏‡¶æ‡¶π‡¶∏‡ßá‡¶∞ ‡¶Ö‡¶≠‡¶æ‡¶¨ ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 5,
      q: "Choose the Bengali meaning of: 'ambiguous'",
      options: ["‡¶∏‡ßç‡¶™‡¶∑‡ßç‡¶ü", "‡¶¶‡ßç‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡¶ï", "‡¶∏‡¶∞‡¶≤", "‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | 'Ambiguous' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßã '‡¶¶‡ßç‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡¶ï' ‡¶¨‡¶æ ‡¶Ö‡¶∏‡ßç‡¶™‡¶∑‡ßç‡¶ü‡•§ ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£‡¶∏‡ßç‡¶¨‡¶∞‡ßÇ‡¶™, ‡¶§‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶ü‡¶ø ‡¶¶‡ßç‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡¶ï (ambiguous) ‡¶õ‡¶ø‡¶≤‡•§"
    },
    {
      id: 6,
      q: "Choose the English meaning of: '‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶æ‡¶®'",
      options: ["Fact", "Proof", "Assumption", "Evidence"],
      answer: 2,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (C) | '‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶æ‡¶®' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø ‡¶Ö‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßã 'Assumption' ‡¶Ø‡¶æ ‡¶ß‡¶æ‡¶∞‡¶£‡¶æ ‡¶¨‡¶æ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶æ‡¶® ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 7,
      q: "Choose the synonym of: 'Diligent'",
      options: ["Lazy", "Hardworking", "Careless", "Slow"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | 'Diligent' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∂‡¶¨‡ßç‡¶¶ ‡¶π‡¶≤‡ßã 'Hardworking' ‡¶Ø‡¶æ ‡¶™‡¶∞‡¶ø‡¶∂‡ßç‡¶∞‡¶Æ‡ßÄ ‡¶¨‡¶æ ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 8,
      q: "Choose the antonym of: 'Generous'",
      options: ["Kind", "Charitable", "Stingy", "Helpful"],
      answer: 2,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (C) | 'Generous' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶¨‡¶ø‡¶™‡¶∞‡ßÄ‡¶§ ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶π‡¶≤‡ßã 'Stingy' ‡¶Ø‡¶æ ‡¶ï‡ßÉ‡¶™‡¶£ ‡¶¨‡¶æ ‡¶Ö‡¶∞‡ßç‡¶•‡¶≤‡ßã‡¶≠‡ßÄ ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 9,
      q: "Choose the Bengali meaning of: 'persistent'",
      options: ["‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ", "‡¶Ö‡¶∏‡ßç‡¶•‡¶ø‡¶∞", "‡¶¶‡ßÅ‡¶∞‡ßç‡¶¨‡¶≤", "‡¶¨‡¶ø‡¶∞‡¶§"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (A) | 'Persistent' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßã '‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ' ‡¶¨‡¶æ ‡¶Ö‡¶¨‡¶ø‡¶∞‡¶æ‡¶Æ‡•§ ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£‡¶∏‡ßç‡¶¨‡¶∞‡ßÇ‡¶™, ‡¶§‡¶ø‡¶®‡¶ø ‡¶§‡¶æ‡¶∞ ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø‡ßá ‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ (persistent) ‡¶õ‡¶ø‡¶≤‡ßá‡¶®‡•§"
    },
    {
      id: 10,
      q: "Choose the English meaning of: '‡¶∏‡¶π‡¶æ‡¶®‡ßÅ‡¶≠‡ßÇ‡¶§‡¶ø'",
      options: ["Apology", "Sympathy", "Anger", "Happiness"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | '‡¶∏‡¶π‡¶æ‡¶®‡ßÅ‡¶≠‡ßÇ‡¶§‡¶ø' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø ‡¶Ö‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßã 'Sympathy' ‡¶Ø‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø‡ßá‡¶∞ ‡¶¶‡ßÅ‡¶É‡¶ñ‡ßá ‡¶∏‡¶Æ‡¶¨‡ßá‡¶¶‡¶®‡¶æ ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 11,
      q: "Choose the synonym of: 'Abundant'",
      options: ["Scarce", "Plentiful", "Limited", "Rare"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | 'Abundant' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∂‡¶¨‡ßç‡¶¶ ‡¶π‡¶≤‡ßã 'Plentiful' ‡¶Ø‡¶æ ‡¶™‡ßç‡¶∞‡¶ö‡ßÅ‡¶∞ ‡¶¨‡¶æ ‡¶™‡ßç‡¶∞‡¶æ‡¶ö‡ßÅ‡¶∞‡ßç‡¶Ø ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 12,
      q: "Choose the antonym of: 'Modern'",
      options: ["Current", "Ancient", "Contemporary", "Recent"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | 'Modern' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶¨‡¶ø‡¶™‡¶∞‡ßÄ‡¶§ ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶π‡¶≤‡ßã 'Ancient' ‡¶Ø‡¶æ ‡¶™‡ßç‡¶∞‡¶æ‡¶ö‡ßÄ‡¶® ‡¶¨‡¶æ ‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 13,
      q: "Choose the Bengali meaning of: 'efficient'",
      options: ["‡¶Ö‡¶¶‡¶ï‡ßç‡¶∑", "‡¶∏‡¶ï‡ßç‡¶∑‡¶Æ", "‡¶¶‡¶ï‡ßç‡¶∑", "‡¶ú‡¶ü‡¶ø‡¶≤"],
      answer: 2,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (C) | 'Efficient' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßã '‡¶¶‡¶ï‡ßç‡¶∑' ‡¶¨‡¶æ ‡¶ï‡¶æ‡¶∞‡ßç‡¶Ø‡¶ï‡¶∞‡•§ ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£‡¶∏‡ßç‡¶¨‡¶∞‡ßÇ‡¶™, ‡¶§‡¶ø‡¶®‡¶ø ‡¶è‡¶ï‡¶ú‡¶® ‡¶¶‡¶ï‡ßç‡¶∑ (efficient) ‡¶ï‡¶∞‡ßç‡¶Æ‡ßÄ‡•§"
    },
    {
      id: 14,
      q: "Choose the English meaning of: '‡¶¨‡¶ø‡¶¨‡ßá‡¶ö‡¶®‡¶æ'",
      options: ["Ignorance", "Consideration", "Neglect", "Rejection"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | '‡¶¨‡¶ø‡¶¨‡ßá‡¶ö‡¶®‡¶æ' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø ‡¶Ö‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßã 'Consideration' ‡¶Ø‡¶æ ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ-‡¶≠‡¶æ‡¶¨‡¶®‡¶æ ‡¶¨‡¶æ ‡¶Æ‡¶®‡ßã‡¶®‡¶ø‡¶¨‡ßá‡¶∂ ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 15,
      q: "Choose the correct spelling:",
      options: ["Neccessary", "Necessary", "Necesary", "Necesarry"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | The correct spelling is 'Necessary'. A useful mnemonic is: 'One Collar and two Sleeves' (one 'c' and two 's's)."
    },
    {
      id: 16,
      q: "Choose the Bengali meaning of: 'Reliable'",
      options: ["‡¶Ö‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶∏‡ßç‡¶§", "‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡¶∞‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø", "‡¶∏‡¶®‡ßç‡¶¶‡ßá‡¶π‡¶ú‡¶®‡¶ï", "‡¶Ö‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | 'Reliable' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßã '‡¶®‡¶ø‡¶∞‡ßç‡¶≠‡¶∞‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø'‡•§ ‡¶Ø‡ßá ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø ‡¶¨‡¶æ ‡¶¨‡¶∏‡ßç‡¶§‡ßÅ‡¶∞ ‡¶â‡¶™‡¶∞ ‡¶≠‡¶∞‡¶∏‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 17,
      q: "Choose the antonym of: 'Expand'",
      options: ["Increase", "Grow", "Contract", "Extend"],
      answer: 2,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (C) | 'Expand' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶¨‡¶ø‡¶™‡¶∞‡ßÄ‡¶§ ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶π‡¶≤‡ßã 'Contract' ‡¶Ø‡¶æ ‡¶∏‡¶ô‡ßç‡¶ï‡ßÅ‡¶ö‡¶ø‡¶§ ‡¶π‡¶ì‡¶Ø‡¶º‡¶æ ‡¶¨‡¶æ ‡¶õ‡ßã‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 18,
      q: "Choose the synonym of: 'Wealthy'",
      options: ["Poor", "Affluent", "Bankrupt", "Needy"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | 'Wealthy' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∂‡¶¨‡ßç‡¶¶ ‡¶π‡¶≤‡ßã 'Affluent' ‡¶Ø‡¶æ ‡¶ß‡¶®‡ßÄ ‡¶¨‡¶æ ‡¶∏‡¶Æ‡ßÉ‡¶¶‡ßç‡¶ß‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 19,
      q: "Choose the English meaning of: '‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ'",
      options: ["Pardon", "Punishment", "Blame", "Criticism"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (A) | '‡¶ï‡ßç‡¶∑‡¶Æ‡¶æ' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø ‡¶Ö‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßã 'Pardon' ‡¶¨‡¶æ 'Forgiveness', ‡¶Ø‡¶æ ‡¶Ö‡¶®‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º ‡¶¨‡¶æ ‡¶¶‡ßã‡¶∑ ‡¶Æ‡¶æ‡¶´ ‡¶ï‡¶∞‡¶æ ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 20,
      q: "Identify the part of speech: 'He ran QUICKLY to the store.'",
      options: ["Noun", "Verb", "Adjective", "Adverb"],
      answer: 3,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (D) | The word 'quickly' modifies the verb 'ran', describing how he ran. Therefore, it is an Adverb."
    },
    {
      id: 21,
      q: "Choose the Bengali meaning of: 'Vulnerable'",
      options: ["‡¶Ö‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§", "‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§", "‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ", "‡¶Ö‡¶ú‡ßá‡¶Ø‡¶º"],
      answer: 0,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (A) | 'Vulnerable' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶• ‡¶π‡¶≤‡ßã '‡¶Ö‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§' ‡¶¨‡¶æ '‡¶∏‡¶π‡¶ú‡ßá ‡¶Ü‡¶ò‡¶æ‡¶§‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§'‡•§ ‡¶Ø‡ßáÂÆπÊòìË¢´‰º§ÂÆ≥ÁöÑ„ÄÇ"
    },
    {
      id: 22,
      q: "Choose the antonym of: 'Simple'",
      options: ["Easy", "Basic", "Complex", "Plain"],
      answer: 2,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (C) | 'Simple' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶¨‡¶ø‡¶™‡¶∞‡ßÄ‡¶§ ‡¶∂‡¶¨‡ßç‡¶¶ ‡¶π‡¶≤‡ßã 'Complex' ‡¶Ø‡¶æ ‡¶ú‡¶ü‡¶ø‡¶≤ ‡¶¨‡¶æ ‡¶∏‡¶Æ‡ßç‡¶Æ‡¶ø‡¶≤‡¶ø‡¶§ ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 23,
      q: "Fill in the blank: 'She is allergic _____ cats.'",
      options: ["with", "to", "for", "by"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | The correct preposition to use with 'allergic' is 'to'. The standard structure is 'allergic to [something]'."
    },
    {
      id: 24,
      q: "Choose the synonym of: 'Brief'",
      options: ["Long", "Short", "Detailed", "Extended"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | 'Brief' ‡¶∂‡¶¨‡ßç‡¶¶‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∂‡¶¨‡ßç‡¶¶ ‡¶π‡¶≤‡ßã 'Short' ‡¶Ø‡¶æ ‡¶∏‡ßç‡¶¨‡¶≤‡ßç‡¶™‡¶∏‡ßç‡¶•‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶¨‡¶æ ‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶¨‡ßã‡¶ù‡¶æ‡¶Ø‡¶º‡•§"
    },
    {
      id: 25,
      q: "Choose the word that best defines: 'A person who is unable to pay their debts'",
      options: ["Millionaire", "Bankrupt", "Investor", "Heir"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | A person who is declared in law unable to pay their debts is called 'Bankrupt'."
    },
    {
      id: 26,
      q: "Choose the Bengali meaning of: 'Nostalgia'",
      options: ["‡¶≠‡¶¨‡¶ø‡¶∑‡ßç‡¶Ø‡¶§‡ßá‡¶∞ ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ", "‡¶Ö‡¶§‡ßÄ‡¶§‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ó‡¶≠‡ßÄ‡¶∞ tƒôsknota", "‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá‡¶∞ ‡¶Ü‡¶®‡¶®‡ßç‡¶¶", "‡¶â‡¶¶‡¶æ‡¶∏‡ßÄ‡¶®‡¶§‡¶æ"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | 'Nostalgia' means a sentimental longing or wistful affection for the past (‡¶Ö‡¶§‡ßÄ‡¶§‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ó‡¶≠‡ßÄ‡¶∞ tƒôsknota)."
    },
    {
      id: 27,
      q: "Choose the antonym of: 'Victory'",
      options: ["Triumph", "Success", "Defeat", "Achievement"],
      answer: 2,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (C) | The direct opposite of 'Victory' (‡¶ú‡¶Ø‡¶º) is 'Defeat' (‡¶™‡¶∞‡¶æ‡¶ú‡¶Ø‡¶º)."
    },
    {
      id: 28,
      q: "Select the correctly punctuated sentence:",
      options: ["The students books are on the table.", "The student's books are on the table.", "The students' books are on the table.", "The students's books are on the table."],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | The apostrophe before the 's' indicates singular possessive (one student owns the books). 'Students'' (Option C) is plural possessive."
    },
    {
      id: 29,
      q: "Choose the synonym of: 'Fragile'",
      options: ["Strong", "Durable", "Delicate", "Tough"],
      answer: 2,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (C) | 'Fragile' means easily broken or damaged. Its synonym is 'Delicate'."
    },
    {
      id: 30,
      q: "Choose the English meaning of: '‡¶∏‡¶§‡¶∞‡ßç‡¶ï'",
      options: ["Careless", "Cautious", "Reckless", "Hasty"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | The Bengali word '‡¶∏‡¶§‡¶∞‡ßç‡¶ï' translates to 'Cautious' in English, meaning careful to avoid potential problems or dangers."
    },
    {
      id: 31,
      q: "Identify the type of word: 'Wow! That was amazing!'",
      options: ["Conjunction", "Interjection", "Preposition", "Adverb"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | 'Wow' is an interjection. It is a word or phrase that expresses strong emotion or surprise."
    },
    {
      id: 32,
      q: "Choose the antonym of: 'Arrogant'",
      options: ["Proud", "Humble", "Egotistical", "Boastful"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | 'Arrogant' means having an exaggerated sense of one's own importance. Its opposite is 'Humble'."
    },
    {
      id: 33,
      q: "What is the past participle form of the verb 'go'?",
      options: ["Goed", "Went", "Gone", "Goes"],
      answer: 2,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (C) | The past participle of the irregular verb 'go' is 'gone' (e.g., I have gone to the store)."
    },
    {
      id: 34,
      q: "Choose the word that is spelled correctly:",
      options: ["Acommodate", "Accommodate", "Acomodate", "Accomodate"],
      answer: 1,
      explain: "‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ: Correct Option-- (B) | The correct spelling is 'Accommodate'. Remember: It's large enough to accommodate two 'c's and two 'm's."
    },

    
];









  // ----------------------------
  // State
  // ----------------------------
  let selectedIds = [];
  let selectedMap = {}; // { qid: optionIndex }
  let endTime = null; // epoch seconds
  let submitted = false;
  let timerHandle = null;

  // ----------------------------
  // DOM Elements
  // ----------------------------
  const examForm = qs('#exam');
  const startBtn = qs('#startBtn');
  const resetBtn = qs('#resetBtn');
  const submitBtn = qs('#submitBtn');
  const timerEl = qs('#timer');
  const summaryEl = qs('#summary');
  const introEl = qs('#intro');

  // ----------------------------
  // Rendering
  // ----------------------------
  function renderQuestions(){
    examForm.innerHTML = '';
    const chosen = QUESTIONS.filter(q=>selectedIds.includes(q.id));
    chosen.forEach((q,idx)=>{
      const qWrap = document.createElement('section');
      qWrap.className = 'question';
      qWrap.setAttribute('data-qid', q.id);

      qWrap.innerHTML = `
        <div class="q-head">
          <div class="q-num">${idx+1}</div>
          <div class="q-text">${q.q}</div>
        </div>
        <div class="options" role="radiogroup" aria-label="Question ${idx+1}">
          ${q.options.map((opt,i)=>{
            const checked = selectedMap[q.id] === i ? 'checked' : '';
            return `
              <label class="option">
                <input type="radio" name="q_${q.id}" value="${i}" ${checked} aria-label="Option ${String.fromCharCode(65+i)}">
                <div class="opt-text"><strong>(${String.fromCharCode(65+i)})</strong> ${opt}</div>
              </label>
            `;}).join('')}
        </div>
      `;

      examForm.appendChild(qWrap);
    });

    // attach listeners
    qsa('input[type=radio]', examForm).forEach(inp=>{
      inp.addEventListener('change', e=>{
        const name = e.target.name; // q_<id>
        const qid = parseInt(name.split('_')[1],10);
        selectedMap[qid] = parseInt(e.target.value,10);
        persist();
      });
    })
  }

  function renderSummary(score, details){
    const total = EXAM_SIZE;
    const correct = details.filter(d=>d.correct).length;
    const wrong = details.filter(d=>d.user!==null && !d.correct).length;
    const unanswered = total - correct - wrong;

    summaryEl.classList.remove('hidden');
    summaryEl.innerHTML = `
      <div style="display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap">
        <div style="display:flex; gap:12px; align-items:center">
          <span class="score-badge" title="Final Score">Score: ${score.toFixed(2)} / ${total.toFixed(2)}</span>
          <span class="chip correct-chip">‚úÖ ${correct} correct</span>
          <span class="chip wrong-chip">‚ùå ${wrong} wrong</span>
          <span class="chip unanswered-chip">‚è≥ ${unanswered} unanswered</span>
        </div>
        <button onclick="window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'})"> Go to Bottom</button>

      </div>
    `;
  }

  function markReview(details){
    // Color options + show explanations
    details.forEach((d,idx)=>{
      const sec = qs(`.question[data-qid="${d.id}"]`);
      if(!sec) return;
      const labels = qsa('.option', sec);
      labels.forEach((lab,i)=>{
        lab.classList.remove('correct','wrong');
        if(i===d.answer) lab.classList.add('correct');
        if(d.user!==null && i===d.user && !d.correct) lab.classList.add('wrong');
        lab.querySelector('input').disabled = true;
      });
      
      // Create explanation container with correct/wrong status
      const expContainer = document.createElement('div');
      expContainer.className = 'explanation-container';
      
      // Add correct/wrong status with icons
      const statusDiv = document.createElement('div');
      statusDiv.className = `result-status ${d.correct ? 'correct-status' : 'wrong-status'}`;
      
       if (d.correct) {
        statusDiv.className = 'result-status correct-status';
        statusDiv.innerHTML = `<i class="fas fa-check-circle"></i> Correct`;
      } else if (d.user !== null) {
        statusDiv.className = 'result-status wrong-status';
        statusDiv.innerHTML = `<i class="fas fa-times-circle"></i> Wrong`;
      } else {
        statusDiv.className = 'result-status unanswered-status';
        statusDiv.innerHTML = `<i class="fas fa-question-circle"></i> Unanswered`;
        //statusDiv.style.color = 'var(--muted)';
      }
      
      // Add explanation text
      const exp = document.createElement('p');
      exp.className = 'explain';
      exp.textContent = d.explain;
      
      // Append elements to container
      expContainer.appendChild(statusDiv);
      expContainer.appendChild(exp);
      
      // Append container to question section
      sec.appendChild(expContainer);
    });
  }

  // ----------------------------
  // Exam Flow
  // ----------------------------
  function startExam(){
    if(selectedIds.length===0){
      selectedIds = pick(QUESTIONS, EXAM_SIZE).map(q=>q.id);
    }
    endTime = Math.floor(Date.now()/1000) + EXAM_MINUTES*60;
    submitted = false;
    submitBtn.disabled = false;
    introEl.classList.add('hidden');
    summaryEl.classList.add('hidden');
    renderQuestions();
    persist();
    startTimer();
  }

  function submitExam(reason='manual'){
    if(submitted) return;
    submitted = true;
    stopTimer();
    submitBtn.disabled = true;

    const chosen = QUESTIONS.filter(q=>selectedIds.includes(q.id));
    const details = chosen.map(q=>{
      const user = (q.id in selectedMap) ? selectedMap[q.id] : null;
      const correct = user===q.answer;
      return { id:q.id, user, answer:q.answer, correct, explain:q.explain };
    });

    const correctCount = details.filter(d=>d.correct).length;
    const wrongCount = details.filter(d=>d.user!==null && !d.correct).length;
    const score = correctCount*1 + wrongCount*(-0.25);

    renderSummary(score, details);
    markReview(details);

    // lock state
    persist();
  }

  function resetExam(){
    stopTimer();
    clearState();
    selectedIds = [];
    selectedMap = {};
    endTime = null;
    submitted = false;
    timerEl.textContent = formatTime(EXAM_MINUTES*60);
    submitBtn.disabled = true;
    summaryEl.classList.add('hidden');
    examForm.innerHTML = '';
    introEl.classList.remove('hidden');
    window.scrollTo({top:0,behavior:'smooth'});
  }

  // ----------------------------
  // Timer
  // ----------------------------
  function startTimer(){
    stopTimer();
    tick();
    timerHandle = setInterval(tick, 1000);
  }
  function stopTimer(){ if(timerHandle){ clearInterval(timerHandle); timerHandle=null; } }
  function tick(){
    const now = Math.floor(Date.now()/1000);
    const remain = Math.max(0, endTime - now);
    timerEl.textContent = formatTime(remain);

    // color hints
    if(remain <= 60){ timerEl.style.background = '#2b0b0b'; timerEl.style.color = '#fecaca'; timerEl.style.borderColor = 'rgba(248,113,113,0.4)'; }
    else if(remain <= 5*60){ timerEl.style.background = '#2b1a0b'; timerEl.style.color = '#fde68a'; timerEl.style.borderColor = 'rgba(245,158,11,0.4)'; }

    if(remain===0){ submitExam('timeout'); }
  }

  // ----------------------------
  // Persistence (sessionStorage)
  // ----------------------------
  function persist(){
    const state = { selectedIds, selectedMap, endTime, submitted };
    saveState(state);
  }
  function restore(){
    const state = loadState();
    if(!state) return;
    selectedIds = state.selectedIds||[];
    selectedMap = state.selectedMap||{};
    endTime = state.endTime||null;
    submitted = !!state.submitted;

    if(selectedIds.length){
      introEl.classList.add('hidden');
      renderQuestions();
      if(submitted){
        // rebuild review
        const chosen = QUESTIONS.filter(q=>selectedIds.includes(q.id));
        const details = chosen.map(q=>{
          const user = (q.id in selectedMap) ? selectedMap[q.id] : null;
          const correct = user===q.answer;
          return { id:q.id, user, answer:q.answer, correct, explain:q.explain };
        });
        const correctCount = details.filter(d=>d.correct).length;
        const wrongCount = details.filter(d=>d.user!==null && !d.correct).length;
        const score = correctCount*1 + wrongCount*(-0.25);
        submitBtn.disabled = true;
        renderSummary(score, details);
        markReview(details);
      } else if(endTime){
        submitBtn.disabled = false;
        startTimer();
      }
    }
  }

  // ----------------------------
  // Wiring
  // ----------------------------
  startBtn.addEventListener('click', () => {
    if(loadState() && !submitted){ if(!confirm('Start a new attempt? Your current attempt will be replaced.')) return; }
    resetExam();
    startExam();
  });
  resetBtn.addEventListener('click', resetExam);
  submitBtn.addEventListener('click', (e)=>{ e.preventDefault(); submitExam('manual'); window.scrollTo({top:0,behavior:'smooth'}); });

  window.addEventListener('beforeunload', (e)=>{
    // gentle reminder if exam running
    const state = loadState();
    if(state && state.selectedIds && state.selectedIds.length && !state.submitted){
      e.preventDefault(); e.returnValue = '';
    }
  });

  // Initialize
  (function init(){
    timerEl.textContent = formatTime(EXAM_MINUTES*60);
    restore();
  })();
  </script>
</body>
</html>